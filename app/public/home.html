<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FriendFinder</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="/style.css">
</head>

<body>
    <div class="jumbotron">
        <h1>
            <em>friend</em>
            <small>FINDER</small>
        </h1>
        <div class="btn-group">
            <a href="/" class="btn btn-info" role="button">Home</a>
            <a href="/survey" class="btn btn-info" role="button">Survey</a>
        </div>
    </div>
    <div id="result"></div>

    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>


    <script>
        $.urlParam = function (name) {
            var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
            if (results == null) {
                return null;
            } else {
                return decodeURI(results[1]) || 0;
            }
        }
        if ($.urlParam("name")) {
            var dbfriends;
            var user = $.urlParam("name");
            $.get("/api/friends", function (data) {
                console.log(user, data);;
                getBestFriend(user, data);
            });
        }
        function getAvg (numArray){
            var x = 0;
            for(var i=0; i < numArray.length; i++){
                x+=numArray[i];
            }
            console.log("getAvg",numArray,x);
            return x/numArray.length;
        }
        function getBestFriend(name, usersarray) {
            var mainUser;
            var otherUsers = [];
            var bestFriend = {
                name: "",
                value: "",
                photo: ""
            }
            for (var i = 0; i < usersarray.length; i++) {
                if (usersarray[i].name === name) {
                    console.log("line 64 - ", usersarray[i].name);
                    mainUser = usersarray[i];
                } else {
                    console.log("line 67 - ", usersarray[i].name);
                    otherUsers.push(usersarray[i])
                }
            }
            for (var i = 0; i < otherUsers.length; i++) { //iterate other users
                var other = otherUsers[i],
                    comparison = []; //place other user on var other
                console.log(other);
                for (var i = 0; i < other.scores.length; i++) { // iterate through other user's scores
                    comparison.push(Math.abs(mainUser.score[i] -
                        other.scores[i]));
                }
                console.log(getAvg(comparison));
                if (getAvg(comparison) > bestFriend.value) {
                    bestFriend.name = other.name;
                    bestFriend.value = comparison;
                    bestFriend.photo = other.photo;
                }
            }
            console.log(bestFriend);
        }
    </script>
</body>

</html>